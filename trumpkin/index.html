<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8.3/dist/teachablemachine-image.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>

<link rel="stylesheet" href="index.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

<title>Trumpkin</title>

<div class="content">
    <h1>TRUMP OR PUMPKIN?</h1>
    <br>
    
    <div class="file">
        <input type="file" onchange="readImg(this);" accept="image/x-png,image/gif,image/jpeg" /> Or enter imgur URL
    </div>

    <input id="url" type="text" onchange="readURL();" />
    <div class="links">
        <a href="https://imgur.com/search?q=trump" target="_blank">Pictures of Trump</a>
        <button onclick="randomImg()">Random</button>
        <a href="https://imgur.com/search?q=pumpkin" target="_blank">Pictures of pumpkins</a>
    </div>
    <div class="img-container">
        <img id="image" src="https://i.imgur.com/VzjBSLz.jpg" crossorigin="anonymous" />
    </div>

    <div id="label-container">
        <i id="loading" class="fas fa-spinner fa-pulse fa-3x"></i>
        <div id="decision"></div>
    </div>
</div>

<div class="created">
    <a href="https://github.com/EricSciullo/trumpkin" target="_blank"><i class="fab fa-github fa-3x"></i></a>
    <br>
    <br>
    Created using a model from 
    <a href="https://teachablemachine.withgoogle.com/train/image" target="_blank">Google's Teachable Machine</a> and 
    <a href="https://www.npmjs.com/package/@tensorflow/tfjs" target="_blank">TensorFlow.js</a>
</div>

<script type="text/javascript" src="images.js"></script>
<script type="text/javascript">
    // More API functions here:
    // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image
    let model;
    const URL = 'https://teachablemachine.withgoogle.com/models/yXQJ6Y6n/';

    init();

    // Load the image model
    async function init() {
        const modelURL = `${URL}model.json`;
        const metadataURL = `${URL}metadata.json`;

        // load the model and metadata
        model = await tmImage.load(modelURL, metadataURL);

        $('#loading').hide();
        predict();
    }

    async function readImg(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();

            reader.onload = async e => {
                const File = $('#image');
                await File
                    .attr('src', e.target.result)

                predict();
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    async function predict() {
        let img = document.getElementById("image");

        let prediction = await model.predict(img);

        let decision = prediction[0].probability > prediction[1].probability 
            ? prediction[0] 
            : prediction[1];
        let probability = (decision.probability * 100).toFixed(2);
        $('#decision')[0].textContent = `${decision.className.toUpperCase()} ${probability}%`;
    }

    async function readURL() {
        let imgUrl = $('#url').val();
        $('#image').attr('src', imgUrl);
        setTimeout(() => {
            predict();
        }, 300);
    }

    function randomImg() {
        let rand = Math.floor(Math.random() * 101);
        let imgurUrl = imgur[rand];

        $('#image').attr('src', imgurUrl);
        setTimeout(() => {
            predict();
        }, 300);
    }
</script>
